<!DOCTYPE html>
<html>
  <head>
    <title>Event Set for Interactions - A-Frame</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/joshskeen/aframe-star-system-component@jskeen/fix-for-aframe-1.2/index.js"></script>
  </head>
  <body>
    <a-scene>
      <a-sphere
        position="0 3.25 -5"
        radius="1"
        color="#EF2D5E"
        look-listener
        id="recordSphere"
      ></a-sphere>
      
      <a-text
        font="mozillavr"
        id="lookupText"
        visible="true"
        color="#000"
        align="center"
        anchor="center"
        position="0 2 -5"
        value="Look Up To Capture\n Your Memories of MHacks"
      ></a-text>


      <a-text

        font="mozillavr"
        id="promptText"
        visible="false"
        color="#FFFF00"
        align="center"
        anchor="center"
        position="0 2 -5"
        opacity="0"
        animation="property: opacity; to: 1; dur: 2000; startEvents: fade-in"
        value="Let us know:\n What's a moment from this weekend\n that you're grateful for?"
      ></a-text>

        <a-sphere
                                        id="stopSphere"
        visible="false"
        position="0 0.25 -5"
        radius="1"
        color="#00274C"
        look-listener2
      ></a-sphere>
      
      
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>

      <a-entity
        id="stars"
        opacity="0"
        animation="property: opacity; to: 1; dur: 2000; startEvents: fade-in"
        star-system="count: 100; radius: 250; depth: 0"
        animation__2="property: rotation; to: 0 360 0; easing: linear; loop: true; dur: 250000"
        visible="false"
      ></a-entity>

      <a-sky color="#eCeCeC"></a-sky>
    </a-scene>
  </body>
  <script>
    AFRAME.registerComponent("look-listener", {
      init: function () {
        var timer;
        var isLooking = false;
        var el = this.el;

        el.addEventListener("mouseenter", function () {
          // User starts looking at the sphere
          isLooking = true;
          timer = setTimeout(function () {
            if (isLooking) {
              beginRecording(el);
            }
          }, 3000); // 3 seconds
        });

        el.addEventListener("mouseleave", function () {
          // User stops looking at the sphere
          isLooking = false;
          clearTimeout(timer);
        });
      },
    });
    
        AFRAME.registerComponent("look-listener2", {
      init: function () {
        var timer;
        var isLooking = false;
        var el = this.el;

        el.addEventListener("mouseenter", function () {
          // User starts looking at the sphere
          isLooking = true;
          timer = setTimeout(function () {
            if (isLooking) {
              stopRecording(el);
            }
          }, 3000); // 3 seconds
        });

        el.addEventListener("mouseleave", function () {
          // User stops looking at the sphere
          isLooking = false;
          clearTimeout(timer);
        });
      },
    });

    function beginRecording(sphereElement) {
      // Hide the sphere
      document.getElementById("recordSphere").setAttribute("visible", false);
      document.getElementById("stopSphere").setAttribute("visible", true);
      
      document.getElementById("promptText").setAttribute("visible", true);

      document.getElementById("lookupText").setAttribute("visible", false);

      document.getElementById("promptText").emit(`fade-in`, null, false);

      // Change the sky color to black
      var sky = document.querySelector("a-sky");
      if (sky) {
        sky.setAttribute("color", "black");
      }

      var sky = document.querySelector("a-sky");
      if (sky) {
        sky.setAttribute("color", "black");
      }

      var stars = document.getElementById("stars");
      if (stars) {
        stars.setAttribute("visible", "true");
        stars.emit(`fade-in`);
      }

      console.log("Recording started");
    }
    function stopRecording(sphereElement) {
      // Hide the sphere
      document.getElementById("recordSphere").setAttribute("visible", true);
      document.getElementById("stopSphere").setAttribute("visible", false);

      document.getElementById("promptText").setAttribute("visible", false);

      document.getElementById("lookupText").setAttribute("visible", true);

      document.getElementById("lookupText").emit(`fade-in`, null, false);

      // Change the sky color to black
      var sky = document.querySelector("a-sky");
      if (sky) {
        sky.setAttribute("color", "#eCeCeC");
      }


      var stars = document.getElementById("stars");
      if (stars) {
        stars.setAttribute("visible", "false");
      }

      console.log("Recording Stopped");
    }
  </script>
</html>
